<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Forecast & Actuals | BizToolHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { height: 6px; width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .date-btn { min-width: 60px; scroll-snap-align: center; }
        .date-btn.active { background: #4f46e5; color: white; border-color: #4f46e5; }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans antialiased">

    <header class="bg-white border-b sticky top-0 z-50 no-print">
        <div class="max-w-[1600px] mx-auto px-6 h-16 flex justify-between items-center">
            <a href="index.html" class="text-xl font-black text-blue-600 uppercase tracking-tighter">BIZTOOLHUB</a>
            <div class="flex gap-3">
                <button onclick="resetData()" class="text-slate-400 text-xs font-bold hover:text-red-500">Reset All Data</button>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto px-6 py-8">
        
        <div class="mb-8">
            <h1 class="text-2xl font-black uppercase tracking-tight">Training & Recovery Roster</h1>
            <p class="text-sm text-slate-500 font-medium">Plan your workouts, set sleep targets, and log your actuals to prevent burnout.</p>
        </div>

        <div class="bg-white p-4 rounded-3xl border border-slate-200 shadow-sm mb-8 no-print">
            <div class="flex items-center justify-between mb-2 px-2">
                <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Past 14 Days</span>
                <span class="text-[10px] font-black uppercase text-indigo-600 tracking-widest">Today</span>
                <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Next 7 Days</span>
            </div>
            <div id="date-scroller" class="flex gap-2 overflow-x-auto custom-scrollbar pb-2 px-2 scroll-smooth" style="scroll-snap-type: x mandatory;">
                </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-8">
            
            <div class="flex-1 space-y-6">
                
                <div class="flex p-1 bg-slate-200 rounded-2xl w-full max-w-md mx-auto">
                    <button id="mode-actual" onclick="setMode('actual')" class="flex-1 py-2 text-sm font-black uppercase tracking-widest rounded-xl transition-all bg-white shadow text-slate-800">Actual Log</button>
                    <button id="mode-forecast" onclick="setMode('goal')" class="flex-1 py-2 text-sm font-black uppercase tracking-widest rounded-xl transition-all text-slate-500 hover:text-slate-700">Forecast / Goal</button>
                </div>

                <div class="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm">
                    <div class="flex justify-between items-center mb-6 border-b border-slate-100 pb-2">
                        <h3 id="input-title-exercise" class="text-[10px] font-black uppercase tracking-widest text-indigo-600">Logging Actual Exercise</h3>
                        <span id="date-indicator" class="text-[10px] font-bold uppercase text-slate-400">Today</span>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest mb-2 block">Exercise Type</label>
                            <select id="ex-type" onchange="saveInputs()" class="w-full bg-slate-50 border border-slate-200 p-4 rounded-xl text-sm font-bold outline-none focus:border-indigo-400 transition text-slate-700 cursor-pointer">
                                <option value="Rest Day">üõãÔ∏è Rest Day</option>
                                <option value="Gym / Weights">üèãÔ∏è Gym / Weights</option>
                                <option value="Running">üèÉ Running</option>
                                <option value="Walking">üö∂ Walking</option>
                                <option value="Cycling">üö¥ Cycling</option>
                                <option value="Swimming">üèä Swimming</option>
                                <option value="Yoga / Mobility">üßò Yoga / Mobility</option>
                                <option value="Sport">üéæ Sport / Match</option>
                                <option value="Other">‚ö° Other</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest mb-2 block">Duration (Minutes)</label>
                            <div class="flex items-center bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                                <button onclick="updateNumber('ex-duration', -5)" class="px-4 py-4 bg-slate-50 hover:bg-slate-100 font-black text-slate-600 border-r border-slate-200 transition">-</button>
                                <input type="number" id="ex-duration" oninput="saveInputs()" placeholder="0" class="w-full text-lg font-black text-center text-indigo-700 outline-none p-2 bg-transparent">
                                <button onclick="updateNumber('ex-duration', 5)" class="px-4 py-4 bg-slate-50 hover:bg-slate-100 font-black text-slate-600 border-l border-slate-200 transition">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm">
                    <h3 class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-6 border-b border-slate-100 pb-2">Sleep & Recovery</h3>
                    
                    <div class="mb-6">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest mb-2 block">Sleep Duration (Hours)</label>
                        <div class="flex items-center bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm max-w-xs">
                            <button onclick="updateNumber('sleep-hrs', -0.5)" class="px-4 py-3 bg-slate-50 hover:bg-slate-100 font-black text-slate-600 border-r border-slate-200 transition">-</button>
                            <input type="number" step="0.5" id="sleep-hrs" oninput="saveInputs()" placeholder="0" class="w-full text-lg font-black text-center text-teal-600 outline-none p-2 bg-transparent">
                            <button onclick="updateNumber('sleep-hrs', 0.5)" class="px-4 py-3 bg-slate-50 hover:bg-slate-100 font-black text-slate-600 border-l border-slate-200 transition">+</button>
                        </div>
                    </div>

                    <textarea id="fitnessNotes" oninput="saveInputs()" placeholder="Optional: Notes on how your body felt, soreness, or workout details..." class="w-full bg-slate-50 border border-slate-100 p-4 rounded-xl text-xs outline-none resize-none h-20 font-medium"></textarea>
                    
                    <button onclick="recordDailyInput()" id="record-btn" class="w-full bg-slate-900 text-white py-4 rounded-xl font-black text-xs hover:bg-slate-800 transition shadow-md mt-6">
                        ‚úÖ Record Actuals for Today
                    </button>
                    
                    <button onclick="applyGoalsForward()" id="bulk-goal-btn" class="hidden w-full bg-indigo-100 text-indigo-700 py-3 rounded-xl font-bold text-xs hover:bg-indigo-200 transition mt-3">
                        ‚è≠Ô∏è Copy this roster to the next 7 days
                    </button>
                </div>
            </div>

            <aside class="lg:w-[600px] flex-shrink-0 space-y-6">
                <div class="bg-slate-900 p-8 rounded-3xl text-white shadow-lg h-full flex flex-col min-h-[500px]">
                    <div class="flex justify-between items-center mb-6 border-b border-slate-800 pb-4">
                        <h3 class="text-[10px] font-black uppercase tracking-widest text-indigo-400">Roster Analysis</h3>
                        <span class="text-[10px] font-black uppercase text-slate-500">21-Day View</span>
                    </div>

                    <div class="flex p-1 bg-slate-800 rounded-xl mb-6 shadow-inner">
                        <button id="chart-exercise-btn" onclick="setChartType('exercise')" class="flex-1 py-2 text-[10px] font-black uppercase rounded-lg bg-slate-700 text-white transition shadow-sm">Exercise (Mins)</button>
                        <button id="chart-sleep-btn" onclick="setChartType('sleep')" class="flex-1 py-2 text-[10px] font-black uppercase rounded-lg text-slate-400 hover:text-white transition">Sleep (Hrs)</button>
                    </div>
                    
                    <div class="flex-1 relative">
                        <canvas id="trendChart"></canvas>
                    </div>
                    <p class="text-[9px] text-slate-500 mt-6 text-center font-bold uppercase tracking-widest">Solid Bar = Actual Logged | Dashed Line = Planned Roster Target</p>
                </div>
            </aside>
        </div>
    </main>

    <script>
        let diary = {};
        let activeDate = "";
        let inputMode = "actual"; 
        let currentChartType = "exercise"; // 'exercise' or 'sleep'
        let chartInstance = null;

        const todayDate = new Date();
        todayDate.setHours(0,0,0,0);

        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('bizFitnessForecast'));
            if(saved) diary = saved;
            
            buildDateScroller();
            loadDay(todayDate.toISOString().split('T')[0]);
        };

        function buildDateScroller() {
            const scroller = document.getElementById('date-scroller');
            scroller.innerHTML = '';
            
            for(let i = -14; i <= 7; i++) {
                const d = new Date(todayDate);
                d.setDate(d.getDate() + i);
                const dateStr = d.toISOString().split('T')[0];
                const isToday = i === 0;
                
                const btn = document.createElement('button');
                btn.className = `date-btn flex flex-col items-center justify-center p-3 rounded-2xl border ${isToday ? 'border-indigo-600 bg-indigo-50' : 'border-slate-200 bg-white hover:bg-slate-50'} transition`;
                btn.id = `btn-date-${dateStr}`;
                btn.onclick = () => loadDay(dateStr);
                
                btn.innerHTML = `
                    <span class="text-[9px] font-black uppercase tracking-widest ${isToday ? 'text-indigo-600' : 'text-slate-400'}">${isToday ? 'Today' : d.toLocaleDateString('en-AU', {weekday:'short'})}</span>
                    <span class="text-lg font-black mt-1 ${isToday ? 'text-indigo-700' : 'text-slate-700'}">${d.getDate()}</span>
                    <span class="text-[8px] font-bold uppercase text-slate-400">${d.toLocaleDateString('en-AU', {month:'short'})}</span>
                `;
                scroller.appendChild(btn);
            }

            setTimeout(() => {
                const todayBtn = document.getElementById(`btn-date-${todayDate.toISOString().split('T')[0]}`);
                if(todayBtn) todayBtn.scrollIntoView({ behavior: 'smooth', inline: 'center' });
            }, 100);
        }

        function setMode(mode) {
            inputMode = mode;
            
            const btnActual = document.getElementById('mode-actual');
            const btnGoal = document.getElementById('mode-forecast');
            const recordBtn = document.getElementById('record-btn');
            const bulkBtn = document.getElementById('bulk-goal-btn');
            const titleEx = document.getElementById('input-title-exercise');
            
            if(mode === 'actual') {
                btnActual.className = "flex-1 py-2 text-sm font-black uppercase tracking-widest rounded-xl transition-all bg-white shadow text-slate-800";
                btnGoal.className = "flex-1 py-2 text-sm font-black uppercase tracking-widest rounded-xl transition-all text-slate-500 hover:text-slate-700 bg-transparent";
                recordBtn.innerHTML = "‚úÖ Record Actuals for Selected Date";
                recordBtn.className = "w-full bg-slate-900 text-white py-4 rounded-xl font-black text-xs hover:bg-slate-800 transition shadow-md mt-6";
                titleEx.innerText = "Logging Actual Exercise";
                bulkBtn.classList.add('hidden');
            } else {
                btnGoal.className = "flex-1 py-2 text-sm font-black uppercase tracking-widest rounded-xl transition-all bg-white shadow text-slate-800";
                btnActual.className = "flex-1 py-2 text-sm font-black uppercase tracking-widest rounded-xl transition-all text-slate-500 hover:text-slate-700 bg-transparent";
                recordBtn.innerHTML = "üéØ Save Roster Plan for Selected Date";
                recordBtn.className = "w-full bg-indigo-600 text-white py-4 rounded-xl font-black text-xs hover:bg-indigo-700 transition shadow-md mt-6";
                titleEx.innerText = "Planning Roster Target";
                bulkBtn.classList.remove('hidden');
            }
            refreshInputs();
        }

        function setChartType(type) {
            currentChartType = type;
            const btnEx = document.getElementById('chart-exercise-btn');
            const btnSleep = document.getElementById('chart-sleep-btn');
            
            if(type === 'exercise') {
                btnEx.className = "flex-1 py-2 text-[10px] font-black uppercase rounded-lg bg-slate-700 text-white transition shadow-sm";
                btnSleep.className = "flex-1 py-2 text-[10px] font-black uppercase rounded-lg text-slate-400 hover:text-white transition";
            } else {
                btnSleep.className = "flex-1 py-2 text-[10px] font-black uppercase rounded-lg bg-slate-700 text-white transition shadow-sm";
                btnEx.className = "flex-1 py-2 text-[10px] font-black uppercase rounded-lg text-slate-400 hover:text-white transition";
            }
            renderChart();
        }

        function getDayData() {
            if(!diary[activeDate]) {
                diary[activeDate] = { 
                    actual: { type: 'Rest Day', duration: 0, sleep: 0, notes: '' }, 
                    goal: { type: 'Rest Day', duration: 0, sleep: 8, notes: '' }
                };
            }
            return diary[activeDate];
        }

        function loadDay(dateStr) {
            if(activeDate) {
                const oldBtn = document.getElementById(`btn-date-${activeDate}`);
                if(oldBtn) oldBtn.classList.remove('active', 'border-indigo-600', 'bg-indigo-600');
            }
            
            activeDate = dateStr;
            const newBtn = document.getElementById(`btn-date-${activeDate}`);
            if(newBtn) newBtn.classList.add('active', 'border-indigo-600', 'bg-indigo-600');

            const selectedDate = new Date(dateStr);
            const isToday = selectedDate.getTime() === todayDate.getTime();
            document.getElementById('date-indicator').innerText = isToday ? 'Today' : selectedDate.toLocaleDateString('en-AU', { weekday: 'long', month: 'short', day: 'numeric' });

            if(selectedDate > todayDate) setMode('goal');
            else setMode('actual');

            refreshInputs();
            renderChart();
        }

        function refreshInputs() {
            const data = getDayData()[inputMode];
            
            document.getElementById('ex-type').value = data.type;
            document.getElementById('ex-duration').value = data.duration || 0;
            document.getElementById('sleep-hrs').value = data.sleep || 0;
            document.getElementById('fitnessNotes').value = data.notes || '';
        }

        function updateNumber(elementId, amount) {
            const el = document.getElementById(elementId);
            let val = parseFloat(el.value) || 0;
            val = Math.max(0, val + amount);
            el.value = val;
            saveInputs();
        }

        function saveInputs() {
            const data = getDayData()[inputMode];
            data.type = document.getElementById('ex-type').value;
            data.duration = parseInt(document.getElementById('ex-duration').value) || 0;
            data.sleep = parseFloat(document.getElementById('sleep-hrs').value) || 0;
            data.notes = document.getElementById('fitnessNotes').value;
            
            silentlySave();
        }

        function silentlySave() {
            localStorage.setItem('bizFitnessForecast', JSON.stringify(diary));
            renderChart();
        }

        function recordDailyInput() {
            saveInputs();
            const btn = document.getElementById('record-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = "‚ú® Saved Successfully!";
            btn.classList.add('bg-green-600', 'text-white');
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('bg-green-600');
            }, 2000);
        }

        function applyGoalsForward() {
            const currentGoal = getDayData().goal;
            for(let i = 1; i <= 7; i++) {
                const futureDate = new Date(todayDate);
                futureDate.setDate(futureDate.getDate() + i);
                const dStr = futureDate.toISOString().split('T')[0];
                
                if(!diary[dStr]) diary[dStr] = { actual: { type: 'Rest Day', duration: 0, sleep: 0, notes: '' }, goal: {} };
                
                // Deep copy
                diary[dStr].goal = JSON.parse(JSON.stringify(currentGoal));
            }
            silentlySave();
            alert("Roster successfully copied to the next 7 days!");
        }

        function renderChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            const labels = [];
            const actualEx = [], goalEx = [];
            const actualSleep = [], goalSleep = [];

            for(let i = -7; i <= 7; i++) {
                const d = new Date(todayDate);
                d.setDate(d.getDate() + i);
                const dStr = d.toISOString().split('T')[0];
                
                labels.push(i === 0 ? 'Today' : d.toLocaleDateString('en-AU', {weekday:'short'}));
                const dayObj = diary[dStr] || { actual: {duration:0, sleep:0}, goal: {duration:0, sleep:8} };
                
                // Actuals stop at 'today'. Future is null.
                actualEx.push(i > 0 ? null : dayObj.actual.duration);
                goalEx.push(dayObj.goal.duration);
                
                actualSleep.push(i > 0 ? null : dayObj.actual.sleep);
                goalSleep.push(dayObj.goal.sleep);
            }

            if(chartInstance) chartInstance.destroy();

            let datasets = [];
            if(currentChartType === 'exercise') {
                datasets = [
                    { label: 'Roster Target (Mins)', data: goalEx, type: 'line', borderColor: '#818cf8', borderWidth: 2, borderDash: [5, 5], fill: false, tension: 0.3, pointRadius: 0, order: 1 },
                    { label: 'Actual Ex. (Mins)', data: actualEx, backgroundColor: 'rgba(79, 70, 229, 0.8)', borderRadius: 4, order: 2 }
                ];
            } else {
                datasets = [
                    { label: 'Target Sleep (Hrs)', data: goalSleep, type: 'line', borderColor: '#2dd4bf', borderWidth: 2, borderDash: [5, 5], fill: false, tension: 0.3, pointRadius: 0, order: 1 },
                    { label: 'Actual Sleep (Hrs)', data: actualSleep, backgroundColor: 'rgba(13, 148, 136, 0.8)', borderRadius: 4, order: 2 }
                ];
            }

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: { labels: labels, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: true, position: 'bottom', labels: { color: '#94a3b8', font: { size: 10, family: 'sans-serif', weight: 'bold' } } }, 
                        tooltip: { mode: 'index', intersect: false } 
                    },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8', font: {family: 'sans-serif', weight: 'bold'} } },
                        x: { grid: { display: false }, ticks: { color: '#94a3b8', font: {family: 'sans-serif', weight: 'bold', size: 9} } }
                    },
                    interaction: { mode: 'nearest', axis: 'x', intersect: false }
                }
            });
        }

        function resetData() {
            if(confirm("Wipe all fitness records and rosters?")) {
                localStorage.removeItem('bizFitnessForecast');
                location.reload();
            }
        }
    </script>
</body>
</html>

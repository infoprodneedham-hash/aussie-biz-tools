<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile Marketing Hub | BizToolHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .active-tab { border-bottom: 4px solid #2563eb; color: #2563eb; font-weight: 900; }
        
        /* Event Lifecycle Labels */
        .status-pill { font-size: 10px; font-weight: 900; text-transform: uppercase; padding: 6px 12px; border-radius: 12px; cursor: pointer; border: 1px solid transparent; width: 100%; text-align: center; }
        .s-proposed { background: #f1f5f9; color: #64748b; border-color: #cbd5e1; }
        .s-active { background: #f0fdf4; color: #16a34a; border-color: #bbf7d0; }
        .s-inactive { background: #fff7ed; color: #c2410c; border-color: #fed7aa; }
        .s-closed { background: #fef2f2; color: #991b1b; border-color: #fecaca; }

        input, select { font-size: 16px !important; } /* Prevent iOS Zoom */
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans antialiased pb-20">

    <header class="bg-white border-b sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-14 flex justify-between items-center">
            <a href="index.html" class="text-sm font-black text-blue-600 tracking-tighter uppercase">BIZTOOLHUB</a>
            <div class="flex gap-4">
                <button onclick="saveAll()" class="text-blue-600 text-[10px] font-black uppercase">Save</button>
                <a href="index.html" class="text-slate-400 text-[10px] font-black uppercase">Exit</a>
            </div>
        </div>
        <div class="flex bg-white border-b overflow-x-auto no-print">
            <button onclick="switchTab('events')" class="tab-btn active-tab flex-1 py-3 text-[10px] font-black uppercase tracking-widest" id="btn-events">Campaigns</button>
            <button onclick="switchTab('pipeline')" class="tab-btn flex-1 py-3 text-[10px] font-black uppercase tracking-widest text-slate-400" id="btn-pipeline">Leads</button>
            <button onclick="switchTab('calendar')" class="tab-btn flex-1 py-3 text-[10px] font-black uppercase tracking-widest text-slate-400" id="btn-calendar">Calendar</button>
        </div>
    </header>

    <main class="p-4">
        
        <div id="events" class="tab-content active space-y-4">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-xs font-black uppercase tracking-widest text-slate-400">Strategy Ledger</h2>
                <button onclick="addEvent()" class="bg-slate-900 text-white px-4 py-2 rounded-xl text-[10px] font-bold">+ New Campaign</button>
            </div>
            <div id="event-list" class="space-y-4"></div>
        </div>

        <div id="pipeline" class="tab-content space-y-4">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-xs font-black uppercase tracking-widest text-slate-400">Pipeline</h2>
                <button onclick="addLead()" class="bg-green-600 text-white px-4 py-2 rounded-xl text-[10px] font-bold">+ New Lead</button>
            </div>
            <div id="lead-list" class="space-y-4"></div>
        </div>

        <div id="calendar" class="tab-content space-y-4">
            <div class="bg-white p-4 rounded-2xl border border-slate-200 shadow-sm">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="calMonth" class="text-sm font-black uppercase tracking-widest">Month</h2>
                    <div class="flex gap-2">
                        <button onclick="changeMonth(-1)" class="p-2 bg-slate-50 rounded-lg text-xs font-bold">←</button>
                        <button onclick="changeMonth(1)" class="p-2 bg-slate-50 rounded-lg text-xs font-bold">→</button>
                    </div>
                </div>
                <div id="calendar-mobile-list" class="space-y-2">
                    </div>
            </div>
        </div>

    </main>

    <div class="fixed bottom-4 right-4 no-print">
        <button onclick="resetAll()" class="bg-white/80 backdrop-blur border border-red-100 text-red-500 w-10 h-10 rounded-full shadow-lg font-black flex items-center justify-center">✕</button>
    </div>

    <script>
        let events = [];
        let leads = [];
        let curDate = new Date();
        
        const lifecycleStates = ['proposed', 'active', 'inactive', 'closed'];
        const eventTypes = ['FB Campaign', 'Leaflet Drop', 'Google Ads', 'Email', 'Print', 'Other'];

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab', 'text-blue-600'));
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-'+id).classList.add('active-tab');
            if(id === 'calendar') renderCalendar();
        }

        // --- CAMPAIGNS LOGIC ---
        function addEvent() {
            events.push({ id: Date.now(), name: '', type: 'FB Campaign', status: 'proposed', duration: '1 Week', start: '', end: '', total: 0, periodic: 0, periodType: 'Weekly' });
            renderEvents();
        }

        function renderEvents() {
            document.getElementById('event-list').innerHTML = events.map(e => `
                <div class="bg-white p-4 rounded-2xl border border-slate-200 shadow-sm space-y-3">
                    <div class="flex justify-between items-start gap-2">
                        <div class="flex-1">
                            <input type="text" value="${e.name}" oninput="updateEvent(${e.id}, 'name', this.value)" placeholder="Campaign Name" class="font-black text-sm w-full bg-transparent outline-none">
                            <select onchange="updateEvent(${e.id}, 'type', this.value)" class="text-[10px] font-bold text-slate-400 uppercase bg-transparent outline-none mt-1">
                                ${eventTypes.map(t => `<option value="${t}" ${e.type===t?'selected':''}>${t}</option>`).join('')}
                            </select>
                        </div>
                        <button onclick="removeEvent(${e.id})" class="text-slate-300">✕</button>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <div class="space-y-1">
                            <label class="text-[8px] font-black uppercase text-slate-400">Status</label>
                            <button onclick="cycleStatus(${e.id})" class="status-pill s-${e.status}">${e.status}</button>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[8px] font-black uppercase text-slate-400">Total Budget</label>
                            <input type="number" value="${e.total}" oninput="updateEvent(${e.id}, 'total', this.value)" class="w-full bg-slate-50 p-2 rounded-lg text-xs font-mono outline-none">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2 pt-2 border-t border-slate-50">
                        <div>
                            <label class="text-[8px] font-black uppercase text-slate-400">Start Date</label>
                            <input type="date" value="${e.start}" onchange="updateEvent(${e.id}, 'start', this.value)" class="w-full text-[10px] bg-slate-50 p-2 rounded-lg uppercase">
                        </div>
                        <div>
                            <label class="text-[8px] font-black uppercase text-slate-400">End Date</label>
                            <input type="date" value="${e.end}" onchange="updateEvent(${e.id}, 'end', this.value)" class="w-full text-[10px] bg-slate-50 p-2 rounded-lg uppercase">
                        </div>
                    </div>
                </div>`).join('');
        }
        
        function updateEvent(id, f, v) { events.find(x => x.id === id)[f] = v; }
        function cycleStatus(id) { 
            let e = events.find(x => x.id === id); 
            e.status = lifecycleStates[(lifecycleStates.indexOf(e.status) + 1) % lifecycleStates.length]; 
            renderEvents(); 
        }
        function removeEvent(id) { events = events.filter(x => x.id !== id); renderEvents(); }

        // --- PIPELINE LOGIC ---
        function addLead() {
            leads.push({ id: Date.now(), name: '', phone: '', email: '', date: new Date().toISOString().split('T')[0], status: 'Attempted', quoteDate: '' });
            renderLeads();
        }
        function renderLeads() {
            document.getElementById('lead-list').innerHTML = leads.map(l => {
                let followUp = '--';
                if(l.quoteDate) {
                    let d = new Date(l.quoteDate); d.setDate(d.getDate() + 7);
                    followUp = d.toLocaleDateString('en-AU', { day: 'numeric', month: 'short' });
                }
                const vStatus = l.status.toLowerCase();
                return `
                <div class="bg-white p-4 rounded-2xl border border-slate-200 shadow-sm space-y-3 ${l.status === 'Sale' ? 'border-green-200 bg-green-50/20' : ''}">
                    <div class="flex justify-between items-start">
                        <div>
                            <input type="text" value="${l.name}" oninput="updateLead(${l.id}, 'name', this.value)" placeholder="Lead Name" class="font-black text-sm w-full bg-transparent outline-none">
                            <span class="text-[10px] font-bold text-slate-400">${new Date(l.date).toLocaleDateString('en-AU')}</span>
                        </div>
                        <button onclick="removeLead(${l.id})" class="text-slate-300">✕</button>
                    </div>

                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" value="${l.phone}" oninput="updateLead(${l.id}, 'phone', this.value)" placeholder="Phone" class="p-2 bg-slate-50 rounded-lg text-xs outline-none">
                        <select onchange="updateLead(${l.id}, 'status', this.value)" class="p-2 rounded-lg text-[10px] font-black uppercase outline-none ${vStatus==='sale'?'bg-green-100 text-green-700':'bg-slate-100 text-slate-500'}">
                            <option value="Attempted" ${l.status==='Attempted'?'selected':''}>Attempted</option>
                            <option value="Quoted" ${l.status==='Quoted'?'selected':''}>Quoted</option>
                            <option value="Sale" ${l.status==='Sale'?'selected':''}>Sale</option>
                            <option value="Lost" ${l.status==='Lost'?'selected':''}>Lost</option>
                        </select>
                    </div>

                    <div class="flex justify-between items-center pt-2 border-t border-slate-50">
                        <div class="flex flex-col">
                            <span class="text-[8px] font-black uppercase text-slate-400">Quote Sent</span>
                            <input type="date" value="${l.quoteDate}" onchange="updateLead(${l.id}, 'quoteDate', this.value)" class="text-[10px] font-bold bg-transparent outline-none">
                        </div>
                        <div class="text-right">
                            <span class="text-[8px] font-black uppercase text-slate-400">7-Day Followup</span>
                            <p class="text-xs font-black ${l.status === 'Sale' ? 'text-green-600' : 'text-orange-500'} uppercase">${l.status === 'Sale' ? 'WON' : followUp}</p>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }
        function updateLead(id, f, v) { leads.find(x => x.id === id)[f] = v; renderLeads(); }
        function removeLead(id) { leads = leads.filter(x => x.id !== id); renderLeads(); }

        // --- CALENDAR LOGIC (MOBILE LIST VIEW) ---
        function renderCalendar() {
            const list = document.getElementById('calendar-mobile-list'); list.innerHTML = '';
            const m = curDate.getMonth(); const y = curDate.getFullYear();
            document.getElementById('calMonth').innerText = new Intl.DateTimeFormat('en-AU', { month: 'long', year: 'numeric' }).format(curDate);
            
            const activeCampaigns = events.filter(e => e.start && e.status !== 'closed');
            
            if(activeCampaigns.length === 0) {
                list.innerHTML = '<p class="text-[10px] text-slate-400 font-bold text-center py-8 uppercase tracking-widest">No Active Campaigns This Month</p>';
                return;
            }

            activeCampaigns.forEach(e => {
                const start = new Date(e.start).toLocaleDateString('en-AU', {day:'numeric', month:'short'});
                const end = e.end ? new Date(e.end).toLocaleDateString('en-AU', {day:'numeric', month:'short'}) : 'Ongoing';
                list.innerHTML += `
                    <div class="flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100">
                        <div>
                            <p class="text-xs font-black text-slate-800">${e.name || 'Unnamed'}</p>
                            <p class="text-[9px] font-bold text-slate-400 uppercase">${start} — ${end}</p>
                        </div>
                        <span class="status-pill s-${e.status} !w-auto !py-1">${e.status}</span>
                    </div>
                `;
            });
        }
        function changeMonth(v) { curDate.setMonth(curDate.getMonth() + v); renderCalendar(); }

        // --- PERSISTENCE ---
        function saveAll() { localStorage.setItem('bizMarketingData', JSON.stringify({ events, leads })); alert('Saved!'); }
        function resetAll() { if(confirm("Wipe all data?")) { localStorage.removeItem('bizMarketingData'); location.reload(); } }
        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('bizMarketingData'));
            if(saved) { events = saved.events || []; leads = saved.leads || []; }
            renderEvents(); renderLeads(); renderCalendar();
        };
    </script>
</body>
</html>
